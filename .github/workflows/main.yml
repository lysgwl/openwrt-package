name: Sync Package Repo

on:
  schedule:
    - cron: '0 */6 * * *' # 每六小时同步一次，您可以根据需要调整

jobs:
  repo-sync:
    runs-on: ubuntu-latest
    
    steps:
  
    - name: Checkout dest repository
      uses: actions/checkout@v2
      with:
        path: 'dest_repo'
        fetch-depth: 0
      
    - name: Checkout shidahuilang repository
      uses: actions/checkout@v2
      with:
        repository: 'shidahuilang/openwrt-package'
        path: 'shidahuilang_rep'
        fetch-depth: 0
    
    - name: Sync directories
      run: |
        rsync -a --delete shidahuilang_repo/ dest_repo/shidahuilang/ --exclude .git
        cd dest_repo
        git config --local user.email "lysgwl@163.com"      # 使用您GitHub的邮箱地址替换
        git config --local user.name "lysgwl"               # 使用您的GitHub用户名替换
        git add .
        if git commit -m "Sync directory with shidahuilang/openwrt-package"; then
          git push
        else
          echo "No changes to commit"
        fi
